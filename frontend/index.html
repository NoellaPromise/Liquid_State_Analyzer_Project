<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Liquid State Analyzer</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <h1>ðŸ§ª Liquid State Analyzer</h1>

      <form id="analyzerForm">
        <div class="form-group">
          <label for="temperature">Temperature (Â°C):</label>
          <input type="number" id="temperature" step="0.1" required />
        </div>

        <div class="form-group">
          <label for="pressure">Atmospheric Pressure (atm):</label>
          <input type="number" id="pressure" step="0.1" value="1.0" required />
        </div>

        <div class="form-group">
          <label for="liquid">Select Liquid:</label>
          <select id="liquid" required>
            <option value="">Choose a liquid...</option>
            <option value="water">Water (Hâ‚‚O)</option>
            <option value="ethanol">Ethanol (Câ‚‚Hâ‚…OH)</option>
            <option value="mercury">Mercury (Hg)</option>
            <option value="nitrogen">Nitrogen (Nâ‚‚)</option>
            <option value="oxygen">Oxygen (Oâ‚‚)</option>
          </select>
        </div>

        <button type="submit" class="analyze-button">
          Analyze Liquid State
        </button>
      </form>

      <div id="error" class="error"></div>

      <div id="results" class="results">
        <div class="flask-container">
          <div class="flask-top"></div>
          <div class="flask-neck"></div>
          <div class="flask">
            <div id="liquidInFlask" class="liquid-still"></div>
          </div>
        </div>

        <div class="state-title" id="stateName">LIQUID</div>

        <div class="result-info" id="liquidName">Liquid Name</div>
        <div class="result-info" id="currentTemp">Temperature: --Â°C</div>
        <div class="result-info" id="currentPressure">Pressure: -- atm</div>
        <div class="result-info" id="stateDescription">
          Description will appear here
        </div>
      </div>
    </div>

    <script>
      // Frontend that calls the Python backend API
      const API_URL = 'http://localhost:5000/api';

      // Load liquids when page loads
      window.addEventListener('DOMContentLoaded', function() {
        loadLiquids();
      });

      function loadLiquids() {
        fetch(`${API_URL}/liquids`)
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              const select = document.getElementById("liquid");
              // Clear existing options except the first one
              select.innerHTML = '<option value="">Choose a liquid...</option>';
              data.liquids.forEach(liquid => {
                const option = document.createElement('option');
                option.value = liquid.key;
                option.textContent = liquid.name;
                select.appendChild(option);
              });
            } else {
              showError("Could not load liquids. Make sure backend_server.py is running!");
            }
          })
          .catch(error => {
            showError("Cannot connect to backend server. Please run: python backend_server.py");
            console.error("Error:", error);
          });
      }

      document
        .getElementById("analyzerForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          const temperature = parseFloat(
            document.getElementById("temperature").value
          );
          const pressure = parseFloat(
            document.getElementById("pressure").value || 1.0
          );
          const liquidType = document.getElementById("liquid").value;

          if (!liquidType) {
            showError("Please select a liquid!");
            return;
          }

          if (pressure <= 0) {
            showError("Pressure must be greater than 0!");
            return;
          }

          // Call backend API
          fetch(`${API_URL}/analyze`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              temperature: temperature,
              pressure: pressure,
              liquid: liquidType
            })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              displayResults(data.result);
            } else {
              showError(data.error || "Analysis failed!");
            }
          })
          .catch(error => {
            showError("Cannot connect to backend server. Please run: python backend_server.py");
            console.error("Error:", error);
          });
        });

      function displayResults(results) {
        document.getElementById("error").style.display = "none";

        showFlaskState(results.flask_state);

        const stateElement = document.getElementById("stateName");
        // Format state for display
        let stateDisplay = results.state;
        stateElement.className = "state-title";
        
        if (results.state === "SOLID") {
          stateDisplay = "SOLID (FROZEN)";
          stateElement.classList.add("solid-state");
        } else if (results.state === "LIQUID") {
          stateDisplay = "LIQUID (STILL)";
          stateElement.classList.add("liquid-state");
        } else if (results.state === "GAS") {
          stateDisplay = "GAS (VAPOR)";
          stateElement.classList.add("gas-state");
        }
        
        stateElement.textContent = stateDisplay;

        document.getElementById("liquidName").textContent = results.liquid_name;
        document.getElementById(
          "currentTemp"
        ).textContent = `Temperature: ${results.temperature}Â°C`;
        document.getElementById(
          "currentPressure"
        ).textContent = `Pressure: ${results.pressure} atm`;
        document.getElementById("stateDescription").textContent =
          results.description;

        document.getElementById("results").classList.add("show");
      }

      function showFlaskState(state) {
        const liquidElement = document.getElementById("liquidInFlask");
        liquidElement.className = "";

        if (state === "frozen") {
          liquidElement.className = "liquid-frozen";
        } else if (state === "boiling") {
          liquidElement.className = "liquid-boiling";
        } else {
          liquidElement.className = "liquid-still";
        }
      }

      function showError(message) {
        const errorDiv = document.getElementById("error");
        errorDiv.textContent = message;
        errorDiv.style.display = "block";
        document.getElementById("results").classList.remove("show");
      }
    </script>
  </body>
</html>
